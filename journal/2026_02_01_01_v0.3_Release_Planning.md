# Development Journal - February 1, 2026

## v0.3 Release Planning

### Objective
Plan the 0.3 release of kotlin-notion-client, focusing on dependency updates and new Notion API features.

---

## Phase 1: Dependency Updates

| Dependency | Current | Latest | Notes |
|------------|---------|--------|-------|
| Kotlin | 2.2.21 | **2.3.0** | Major update |
| Ktor | 3.3.1 | **3.4.0** | HTTP client |
| Kotest | 6.0.4 | **6.1.2** | Test framework |
| kotlinx-datetime | 0.6.2 | 0.7.x? | **Investigate**: 0.7.x uses `kotlin.time.Instant` which may now be stable in Kotlin 2.3 |
| logback | 1.5.20 | 1.5.27 | Logging |
| maven-publish | 0.34.0 | 0.36.0 | Publishing plugin |

**Action**: After Kotlin 2.3 upgrade, check if `kotlin.time.Instant` is no longer `@ExperimentalTime` - if stable, upgrade kotlinx-datetime to 0.7.x.

---

## Phase 2: New Pages API Features

### 2a. Move Page Endpoint (New)
- **Endpoint**: `POST /v1/pages/{page_id}/move`
- **Implementation**: Add `move(pageId, parent)` method to `PagesApi`
- **Models**: `MovePageRequest` with `parent` (page_id or data_source_id)
- **Reference**: `reference/notion-api/documentation/endpoints/Move_Page.md`

### 2b. Create Page Enhancements
- **Template parameter**: `template { type, template_id? }`
- **Position parameter**: `position { type: after_block|page_start|page_end, after_block? }`
- **data_source_id parent type** (may already be partially there via DataSourcesApi)
- **Models**: Update `CreatePageRequest`, `CreatePageRequestBuilder`
- **Reference**: `reference/notion-api/documentation/endpoints/Create_Page_2025.md`

### 2c. Update Page Enhancements
- **`is_locked`** property (boolean)
- **`erase_content`** flag (boolean)
- **`template`** parameter (same structure as create)
- **Models**: Update `UpdatePageRequest`, `UpdatePageRequestBuilder`
- **Reference**: `reference/notion-api/documentation/endpoints/Update_Page_2025.md`

---

## Phase 3: Templates API

- **New endpoint**: `GET /v1/data_sources/{data_source_id}/templates`
- **Response model**: `TemplatesResponse { templates: List<Template>, has_more, next_cursor }`
- **Template model**: `Template { id, name, is_default }`
- **Implementation**: Add `listTemplates(dataSourceId)` to `DataSourcesApi`
- **Reference**: `reference/notion-api/documentation/general/11_Creating_Pages_From_Templates.md`

---

## Phase 4: Query Filters (Lower Priority)

- **Timestamp filters**: Filter by `created_time` or `last_edited_time` page metadata
  - Different from date property filters (no property name, applies to page itself)
  - Uses date filter conditions but with special `timestamp` filter type
  - Reference: `reference/notion-api/documentation/general/07_Filter_Database_Entries.md`

---

## Phase 5: Page Object Model Updates

- Add `is_locked: Boolean?` to `Page` model if not present
- Verify all new response fields are handled

---

## Reference Documentation Added

New documentation saved during this planning session:
- `reference/notion-api/documentation/general/11_Creating_Pages_From_Templates.md`
- `reference/notion-api/documentation/endpoints/Create_Page_2025.md`
- `reference/notion-api/documentation/endpoints/Update_Page_2025.md`
- `reference/notion-api/documentation/endpoints/Move_Page.md`

---

## Suggested Order of Work

1. **Dependency updates** (can be done first, low risk)
2. **Verify integration tests still work** (sanity check before changes)
3. **Page model updates** (`is_locked` property)
4. **Move page endpoint** (new, self-contained)
5. **Update page enhancements** (`is_locked`, `erase_content`, `template`)
6. **Create page enhancements** (`template`, `position`)
7. **Templates API** (list templates endpoint)
8. **Timestamp filters** (if time permits)

---

## Status

- [x] Requirements gathering
- [x] API documentation review
- [x] Reference docs saved
- [x] Dependency updates (except kotlinx-datetime)
- [ ] kotlinx-datetime 0.7.x migration
- [ ] Integration test verification
- [ ] Implementation
- [ ] Testing
- [ ] Release

---

## Session Notes

### Dependency Update Analysis (Feb 1, 2026)

#### Ktor 3.4.0 - No Action Required
- SwaggerUI/OpenAPI changes: Not relevant (client-only library)
- Token caching behavior: Not affected (static bearer tokens via `loadTokens`)
- HttpStatement execution context: Standard patterns, no impact expected

#### Kotlin 2.3.0 - Key Finding
- **`kotlin.time.Instant` is now STABLE** - no longer `@ExperimentalTime`
- This enables upgrading kotlinx-datetime to 0.7.x as planned
- No breaking changes affecting this JVM-only library

#### Kotest 6.x Upgrade Side Effect
- Smart-cast contracts improved - triggered warnings for unnecessary `!!` and casts
- Fixed in test files: `NotionApiLimitsTest`, `PagePropertyPlaceTest`, `PagePropertyUniqueIdTest`, `PagePropertyUnknownTypeTest`

### Dependencies Updated
| Dependency | From | To |
|------------|------|-----|
| Kotlin | 2.2.21 | 2.3.0 |
| Ktor | 3.3.1 | 3.4.0 |
| Kotest | 6.0.4 | 6.1.2 |
| logback | 1.5.20 | 1.5.27 |
| maven-publish | 0.34.0 | 0.36.0 |

### Next: kotlinx-datetime 0.7.x Migration
- Will change from `kotlinx.datetime.Instant` to `kotlin.time.Instant`
- Import changes required throughout codebase
- Separate commit recommended
